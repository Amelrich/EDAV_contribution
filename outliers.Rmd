# Outliers {#outliers}

![](images/banners/banner_outliers.png)
*Ce chapitre est à l'origine une contribution de  [	kiransaini](https://github.com/kiransaini){target="_blank"}*

*En cours de progression. Toute amélioration est la bienvenue. Si vous souhaitez participer rendez vous sur [contributing to our repo](contribute.html).*

## Vue d'ensemble

Cette section explique quels types de outliers rencontrés dans les données et comment les gérer.

## tl;dr

Je veux voir mon outliers!

Les outliers sont difficiles à repérer car juger un point de données en tant que outliers dépend des données ou du modèle avec lequel ils sont comparés. Il est important de détecter outliers car ils peuvent fausser les prévisions et affecter la précision du modèle.

## Que sont outliers?

Les outliers sont très clairement loin du nuage de données. Il peut s'agir d'erreurs, de véritables valeurs extrêmes, de valeurs rares, de valeurs inhabituelles, de cas présentant un intérêt particulier ou de données provenant d'une autre source.
Outliers pour les variables individuelles peut être repéré avec [boxplots](box.html) et bivariate outliers peut être repéré avec [scatterplots](scatter.html). Il peut aussi y avoir des high dimensional outliers qui ne sont pas outliers dans lower dimensions.

Cela vaut la peine d'identifier outliers pour un certain nombre de raisons. Le mauvais outliers doit toujours être corrigé et de nombreux statistical methods peuvent ne pas bien fonctionner en présence de outliers, mais un bon outliers peut être intéressant. Regardons le outliers du 'carat' variable dans le 'diamond' dataset:

```{r echo = FALSE, message=FALSE}

library(ggplot2)
library(tidyverse)
p <- ggplot(diamonds, aes(y=carat)) + 
  geom_boxplot(color="black", fill="lightblue") + 
  ggtitle("Ouliers on carat variable in diamonds dataset")
p

```

## Types de Outliers

### Univariate Outliers
**Univariate outliers** sont outliers le long d'une dimension. L’approche la plus connue pour un premier examen des données consiste à utiliser boxplots. [Tukey](https://en.wikipedia.org/wiki/John_Tukey){target="_blank"} suggère de marquer les cas individuels comme outliers s'ils sont plus que 1.5 IQR (the interquartile range) en dehors du hinges (essentiellement le quartiles). Outliers peuvent changer s’ils sont regroupés par une autre variable. Examinons outliers du Sepal.Width variable dans le `iris` dataset, à la fois lorsque les données sont regroupées par Species et quand elles ne le sont pas. Les outliers sont clairement différents:
```{r}

p <- ggplot(iris, aes(x=Species, y=Sepal.Width)) + 
  geom_boxplot(color="black", fill="lightblue") + 
  ggtitle("Boxplot for Sepal Width grouped by Species in iris dataset")
p
p <- ggplot(iris, aes(y=Sepal.Width)) + 
  geom_boxplot(color="black", fill="lightblue") + 
  ggtitle("Boxplot for Sepal Width in iris dataset")
p
```

### Multivariate Outliers 
**Multivariate outliers** sont outliers le long de plus d'une dimension. Scatterplots et parallel coordinate plots sont utiles pour visualizing multivariate outliers. Vous pouvez considérer les points outliers comme étant éloignés de la masse des données ou les points outliers comme ne correspondant pas à smooth curve. Certains points sont outliers sur les deux critères. Regardons outliers sur les variables Petal.Length et Sepal.Width du 'iris' dataset. Nous pouvons clairement voir un outlier qui est loin de la masse des données (en bas à gauche):
```{r}
ggplot(iris, aes(x=Sepal.Width, y=Petal.Length)) + 
  geom_point() +
  ggtitle("Scatterplot for Petal Length vs Sepal Width in iris dataset")

```

Regardons outliers sur les variables Petal.Length et Petal.Width dans le 'iris' dataset en ajustant un smooth curve. Ici, les outliers sont les points qui ne sont pas fit le smooth model:
```{r}
ggplot(iris, aes(x=Petal.Width, y=Petal.Length)) + 
  geom_point() + 
  geom_smooth() + 
  geom_density2d(col="red",bins=4) + 
  ggtitle("Scatterplot for Petal Length vs Petal Width in iris dataset")
```

Regardons outliers dans le `diamond` dataset en utilisant un parallel coordinate plot. Nous pouvons voir un outlier sur le carat, cut, color, et clarity variables qui n'est pas un outlier sur des variables individuelles:
```{r message=FALSE}
library(GGally)
ggparcoord(diamonds[1:1000,], columns=1:5, scale="uniminmax", alpha=0.8) + 
  ggtitle("Parallel coordinate plot of diamonds dataset")
```

### Categorical Outliers
Outliers peut être rare sur un categorical scale. Certaines combinaisons de catégories sont rares ou ne devraient pas se produire du tout. Fluctuation diagrams peut être utilisé pour trouver un tel outliers. Nous pouvons voir des cas rares dans le `HairEyeColor` dataset:
```{r fig.height=8, fig.width=8}
library(datasets)
library(extracat)

fluctile(HairEyeColor)
```

## Handling Outliers

facile par rapport à ce qu'il faut faire après avoir identifié le outliers. Outliers peuvent être des cas rares, des valeurs inhabituelles ou de véritables erreurs. Véritables erreurs doivent être corrigées si possible, sinon elles doivent être supprimées. Imputation of outliers est compliqué et des connaissances de base appropriées sont requises.

Une stratégie pour traiter avec outliers est la suivante

1. Tracez le 1-D distributions des variables en utilisant boxplots. Examinez tous les extreme outliers pour voir s’ils sont des valeurs rares ou des erreurs et décidez si elles doivent être supprimées ou en imputed.

2. Pour outliers qui sont extreme sur 1-D, examinez leurs valeurs sur d’autres dimensions pour décider si elles doivent être supprimées ou non. Ignorez les valeurs outliers sur plusieurs dimensions.

3. Considérons les cas qui sont outliers dans une dimension supérieure mais pas dans une dimension inférieure. Déterminez s’il s’agit ou non d’erreurs et envisagez de les éliminer ou de imputing.

4. Tracez boxplots et parallel coordinate plots en utilisant le regroupement sur une variable pour trouver outliers dans des sous-ensembles de données.

### Not informative

Considérons le jeu de données `diamonds`. Regardons les variables width (y) et depth (z):
```{r}
ggplot(diamonds, aes(y=y)) + 
  geom_boxplot(color="black", fill="#9B3535") + 
  ggtitle("Ouliers on width variable in diamonds dataset")
```
```{r}
ggplot(diamonds, aes(y=z)) + 
  geom_boxplot(color="black", fill="#9B3535") + 
  ggtitle("Ouliers on depth variable in diamonds dataset")
```

```{r}
ggplot(diamonds, aes(y, z)) + 
  geom_point(col = "#9B3535") + 
  xlab("width") + 
  ylab("depth")
```

### More informative
Les plots ne sont pas très informatives en raison du outliers. Les mêmes plots après filtrage du outliers sont beaucoup plus informatives:
```{r}
d2 <- filter(diamonds, y > 2 & y < 11 & z > 1 & z < 8)
ggplot(d2, aes(y=y)) + 
  geom_boxplot(color="black", fill="lightblue") + 
  ggtitle("Ouliers on width variable in diamonds dataset")
```
```{r}
d2 <- filter(diamonds, y > 2 & y < 11 & z > 1 & z < 8)
ggplot(d2, aes(y=z)) + 
  geom_boxplot(color="black", fill="lightblue") + 
  ggtitle("Ouliers on depth variable in diamonds dataset")
```
```{r}
d2 <- filter(diamonds, y > 2 & y < 11 & z > 1 & z < 8)
ggplot(d2, aes(y, z)) + 
  geom_point(shape = 21, color = "darkGrey", fill = "lightBlue", stroke = 0.1) + 
  xlab("width") + 
  ylab("depth")
```


## External Resources

- [Identify, describe, plot, and remove the outliers from the dataset](https://www.r-bloggers.com/identify-describe-plot-and-remove-the-outliers-from-the-dataset/){target="_blank"}: Plotting and removing outliers from a dataset

- [A Brief Overview of Outlier Detection Techniques](https://towardsdatascience.com/a-brief-overview-of-outlier-detection-techniques-1e0b2c19e561){target="_blank"}: Discussion of the theoretical aspect of outlier detection



